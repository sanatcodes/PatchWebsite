---
import Button from '../ui/Button.astro';

interface Props {
    title: string;
    description?: string;
    details?: Array<{ label: string; value: string }>;
    primaryCta?: { text: string; href: string };
    secondaryCta?: { text: string; href: string };
    class?: string;
}

const { title, description, details = [], primaryCta, secondaryCta, class: className } = Astro.props;

// Left rail: hands-on building
const leftPhotos = [
    { src: "/Example2.jpg", alt: "Patch participants collaborating" },
    { src: "/Robodog.jpg", alt: "Robot dog project showcase" },
    { src: "/example1.jpg", alt: "Patch workshop session" },
];

// Right rail: people collaborating
const rightPhotos = [
    { src: "/Example3.jpg", alt: "Patch community event" },
    { src: "/JohnCollisonWithPatchers.jpg", alt: "John Collison with Patch participants" },
    { src: "/AlumniLedInitiatives/HackIrelandGroupPicture.jpg", alt: "Hack Ireland group photo" },
];

// Bottom rail: identity moments
const bottomPhotos = [
    { src: "/RobotGirl.jpg", alt: "Student with robotics project" },
    { src: "/AlumniPhotos/AidanWithRocket.jpg", alt: "Aidan with rocket project" },
    { src: "/SFFellowshipGoldenGateGroup.JPG", alt: "San Francisco fellowship at Golden Gate" },
    { src: "/PatrickCollisonWithGroupOfPatchersInSFFellowship.png", alt: "Patrick Collison with Patchers in SF Fellowship" },
];
---

<section class:list={['apply-section', className]} id="apply">
    <div class="photo-rail rail-left" aria-hidden="true">
        {leftPhotos.map((photo) => (
            <img src={photo.src} alt={photo.alt} loading="lazy" />
        ))}
    </div>

    <div class="apply-content">
        <h2>{title}</h2>
        {description && <p class="apply-description">{description}</p>}

        {details.length > 0 && (
            <div class="apply-details">
                {details.map((detail) => (
                    <div class="apply-detail">
                        <div class="apply-detail-label">{detail.label}</div>
                        <div class="apply-detail-value">{detail.value}</div>
                    </div>
                ))}
            </div>
        )}

        <div class="apply-buttons">
            {primaryCta && (
                <Button variant="cta" href={primaryCta.href}>
                    {primaryCta.text}
                </Button>
            )}
            {secondaryCta && (
                <Button variant="secondary" href={secondaryCta.href}>
                    {secondaryCta.text}
                </Button>
            )}
        </div>
    </div>

    <div class="photo-rail rail-right" aria-hidden="true">
        {rightPhotos.map((photo) => (
            <img src={photo.src} alt={photo.alt} loading="lazy" />
        ))}
    </div>

    <div class="photo-rail rail-bottom" aria-hidden="true">
        {bottomPhotos.map((photo) => (
            <img src={photo.src} alt={photo.alt} loading="lazy" />
        ))}
    </div>
</section>

<style>
    .apply-section {
        position: relative;
        padding: 140px 24px 200px;
        min-height: 760px;
        background: linear-gradient(to bottom,
            rgba(254, 252, 232, 0.35),
            rgba(255, 255, 255, 0.6)
        );
        overflow: hidden;
    }

    /* Soft edge masking for cropped photos */
    .apply-section::after {
        content: '';
        position: absolute;
        inset: 0;
        pointer-events: none;
        z-index: 3;
        background:
            linear-gradient(to bottom,
                rgba(255, 255, 255, 0.95),
                rgba(255, 255, 255, 0) 12%,
                rgba(255, 255, 255, 0) 88%,
                rgba(255, 255, 255, 0.95)
            ),
            linear-gradient(to right,
                rgba(255, 255, 255, 0.95),
                rgba(255, 255, 255, 0) 12%,
                rgba(255, 255, 255, 0) 88%,
                rgba(255, 255, 255, 0.95)
            );
    }

    .apply-content {
        position: relative;
        z-index: 2;
        max-width: 620px;
        margin: 0 auto;
        text-align: center;
    }

    .apply-content h2 {
        font-size: var(--text-3xl, 2.5rem);
        font-weight: 400;
        font-family: Georgia, 'Times New Roman', serif;
        color: var(--color-accent-blue, #0751cf);
        margin-bottom: 24px;
        line-height: 1.2;
    }

    .apply-description {
        font-size: var(--text-lg, 1.125rem);
        color: var(--text-secondary, #5a6372);
        line-height: 1.7;
        margin: 0 auto 40px;
    }

    .apply-details {
        display: flex;
        justify-content: center;
        gap: 40px;
        padding: 24px 32px;
        margin: 32px auto;
        border: 1px solid var(--default-border-color, rgba(198, 202, 210, 0.5));
        border-radius: 4px;
        background: rgba(255, 255, 255, 0.6);
        backdrop-filter: blur(10px);
    }

    .apply-detail {
        text-align: center;
    }

    .apply-detail-label {
        font-size: var(--text-xs, 0.6875rem);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--color-offgray-300, #b8bdc7);
        margin-bottom: 4px;
        font-weight: 500;
    }

    .apply-detail-value {
        font-size: var(--text-md, 1rem);
        font-weight: 500;
        color: var(--text-primary, #22252b);
    }

    .apply-buttons {
        display: flex;
        gap: 12px;
        justify-content: center;
        flex-wrap: wrap;
    }

    /* Photo rails - structural approach */
    .photo-rail {
        position: absolute;
        display: flex;
        gap: 12px;
        pointer-events: none;
        z-index: 1;
        filter: saturate(0.95);
    }

    .photo-rail img {
        width: 112px;
        max-width: 112px;
        height: 140px;
        max-height: 140px;
        object-fit: cover;
        border-radius: 8px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
        flex-shrink: 0;
    }

    /* Rails anchored to center for true U-shape */
    .rail-left {
        top: 120px;
        left: 50%;
        transform: translateX(-380px);
        flex-direction: column;
        align-items: flex-end;
    }

    /* Left rail curve - top to bottom moves outward */
    .rail-left img:nth-child(1) { margin-right: 60px; }
    .rail-left img:nth-child(2) { margin-right: 30px; }
    .rail-left img:nth-child(3) { margin-right: 0; }

    .rail-right {
        top: 120px;
        left: 50%;
        transform: translateX(268px);
        flex-direction: column;
        align-items: flex-start;
    }

    /* Right rail curve - mirror of left */
    .rail-right img:nth-child(1) { margin-left: 60px; }
    .rail-right img:nth-child(2) { margin-left: 30px; }
    .rail-right img:nth-child(3) { margin-left: 0; }

    .rail-bottom {
        bottom: 60px;
        left: 50%;
        transform: translateX(-50%);
        flex-direction: row;
        align-items: flex-end;
    }

    /* Bottom rail curve - center peaks upward */
    .rail-bottom img:nth-child(1) { margin-bottom: 0; }
    .rail-bottom img:nth-child(2) { margin-bottom: 24px; }
    .rail-bottom img:nth-child(3) { margin-bottom: 24px; }
    .rail-bottom img:nth-child(4) { margin-bottom: 0; }

    /* Subtle hover animation for continuity */
    @media (min-width: 1024px) {
        .photo-rail img {
            transition: transform 0.4s ease;
        }

        .apply-section:hover .photo-rail img {
            transform: translateY(-2px);
        }
    }

    /* Tablet: pull rails in tighter */
    @media (max-width: 1024px) {
        .apply-section {
            min-height: 680px;
            padding: 120px 24px 180px;
        }

        .photo-rail img {
            width: 96px;
            max-width: 96px;
            height: 120px;
            max-height: 120px;
        }

        .rail-left {
            transform: translateX(-300px);
        }

        .rail-right {
            transform: translateX(204px);
        }

        .rail-left img:nth-child(1) { margin-right: 45px; }
        .rail-left img:nth-child(2) { margin-right: 22px; }
        .rail-left img:nth-child(3) { margin-right: 0; }

        .rail-right img:nth-child(1) { margin-left: 45px; }
        .rail-right img:nth-child(2) { margin-left: 22px; }
        .rail-right img:nth-child(3) { margin-left: 0; }
    }

    /* Mobile: fade and crop */
    @media (max-width: 768px) {
        .apply-section {
            padding: 100px 24px 160px;
            min-height: 600px;
        }

        .photo-rail {
            opacity: 0.4;
        }

        .photo-rail img {
            width: 80px;
            max-width: 80px;
            height: 100px;
            max-height: 100px;
        }

        .rail-left {
            transform: translateX(-240px);
            top: 100px;
        }

        .rail-right {
            transform: translateX(160px);
            top: 100px;
        }

        .rail-bottom {
            bottom: 40px;
        }

        .apply-content h2 {
            font-size: var(--text-2xl, 2rem);
        }

        .apply-details {
            flex-wrap: wrap;
            gap: 24px;
            padding: 20px;
        }

        .apply-detail {
            flex: 1 1 40%;
            min-width: 100px;
        }
    }

    /* Small mobile: crop photos, don't hide */
    @media (max-width: 480px) {
        .apply-section {
            padding: 72px 20px 160px;
            min-height: 580px;
            overflow: hidden;
        }

        .photo-rail img {
            width: 88px;
            max-width: 88px;
            height: 110px;
            max-height: 110px;
        }

        .rail-left {
            transform: translateX(-200px);
            top: 80px;
        }

        .rail-right {
            transform: translateX(112px);
            top: 80px;
        }

        .rail-bottom {
            bottom: -90px;
        }

        .apply-content h2 {
            font-size: var(--text-xl, 1.5rem);
        }

        .apply-details {
            gap: 20px;
            padding: 16px;
        }

        .apply-buttons {
            flex-direction: column;
            width: 100%;
        }

        .apply-buttons :global(.btn) {
            width: 100%;
        }
    }
</style>
