---
import Button from '../ui/Button.astro';

interface Props {
    title: string;
    description?: string;
    details?: Array<{ label: string; value: string }>;
    primaryCta?: { text: string; href: string };
    secondaryCta?: { text: string; href: string };
    class?: string;
}

const { title, description, details = [], primaryCta, secondaryCta, class: className } = Astro.props;

// Single arc of 15 photos - stacked at outer 2 layers, singles toward center
const arcPhotos = [
    "/RobotGirl.jpg",           // 1 - far left stack top
    "/Example2.jpg",            // 2 - far left stack bottom
    "/Robodog.jpg",             // 3 - 2nd layer left stack top
    "/example1.jpg",            // 4 - 2nd layer left stack bottom
    "/AlumniPhotos/AidanWithRocket.jpg",  // 5 - single
    "/SFFellowshipGoldenGateGroup.JPG",   // 6 - single
    "/PatrickCollisonWithGroupOfPatchersInSFFellowship.png", // 7 - single
    "/SummerProgrammeRobodogStage.jpg",   // 8 - center
    "/JohnCollisonWithPatchers.jpg",      // 9 - single
    "/SFFellowshipGoldenGateGroup.JPG",   // 10 - single
    "/AlumniPhotos/AidanWithRocket.jpg",  // 11 - single
    "/example1.jpg",            // 12 - 2nd layer right stack top
    "/Robodog.jpg",             // 13 - 2nd layer right stack bottom
    "/Example2.jpg",            // 14 - far right stack top
    "/RobotGirl.jpg",           // 15 - far right stack bottom
];
---

<section class:list={['apply-section', className]} id="apply">
    <div class="photo-arc" aria-hidden="true">
        {arcPhotos.map((src) => (
            <img src={src} loading="lazy" />
        ))}
    </div>

    <div class="apply-content">
        <h2>{title}</h2>
        {description && <p class="apply-description">{description}</p>}

        {details.length > 0 && (
            <div class="apply-details">
                {details.map((detail) => (
                    <div class="apply-detail">
                        <div class="apply-detail-label">{detail.label}</div>
                        <div class="apply-detail-value">{detail.value}</div>
                    </div>
                ))}
            </div>
        )}

        <div class="apply-buttons">
            {primaryCta && (
                <Button variant="cta" href={primaryCta.href}>
                    {primaryCta.text}
                </Button>
            )}
            {secondaryCta && (
                <Button variant="secondary" href={secondaryCta.href}>
                    {secondaryCta.text}
                </Button>
            )}
        </div>
    </div>
</section>

<style>
    .apply-section {
        position: relative;
        padding: 100px 24px 280px;
        min-height: 700px;
        background: linear-gradient(to bottom,
            rgba(254, 252, 232, 0.35),
            rgba(255, 255, 255, 0.6)
        );
        overflow: hidden;
    }

    /* Soft edge masking for cropped photos */
    .apply-section::after {
        content: '';
        position: absolute;
        inset: 0;
        pointer-events: none;
        z-index: 3;
        background:
            linear-gradient(to bottom,
                rgba(255, 255, 255, 0.95),
                rgba(255, 255, 255, 0) 12%,
                rgba(255, 255, 255, 0) 88%,
                rgba(255, 255, 255, 0.95)
            ),
            linear-gradient(to right,
                rgba(255, 255, 255, 0.95),
                rgba(255, 255, 255, 0) 12%,
                rgba(255, 255, 255, 0) 88%,
                rgba(255, 255, 255, 0.95)
            );
    }

    /* Protected text column */
    .apply-content {
        position: relative;
        z-index: 2;
        max-width: 620px;
        margin: 0 auto;
        text-align: center;
    }

    .apply-content h2 {
        font-size: var(--text-3xl, 2.5rem);
        font-weight: 400;
        font-family: Georgia, 'Times New Roman', serif;
        color: var(--color-accent-blue, #0751cf);
        margin-bottom: 24px;
        line-height: 1.2;
    }

    .apply-description {
        font-size: var(--text-lg, 1.125rem);
        color: var(--text-secondary, #5a6372);
        line-height: 1.7;
        margin: 0 auto 40px;
    }

    .apply-details {
        display: flex;
        justify-content: center;
        gap: 40px;
        padding: 24px 32px;
        margin: 32px auto;
        border: 1px solid var(--default-border-color, rgba(198, 202, 210, 0.5));
        border-radius: 4px;
        background: rgba(255, 255, 255, 0.6);
        backdrop-filter: blur(10px);
    }

    .apply-detail {
        text-align: center;
    }

    .apply-detail-label {
        font-size: var(--text-xs, 0.6875rem);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--color-offgray-300, #b8bdc7);
        margin-bottom: 4px;
        font-weight: 500;
    }

    .apply-detail-value {
        font-size: var(--text-md, 1rem);
        font-weight: 500;
        color: var(--text-primary, #22252b);
    }

    .apply-buttons {
        display: flex;
        gap: 12px;
        justify-content: center;
        flex-wrap: wrap;
    }

    /* ===== PHOTO ARC - Single horizontal baseline ===== */
    .photo-arc {
        position: absolute;
        left: 50%;
        top: 420px;
        width: 0;
        pointer-events: none;
        z-index: 1;
    }

    .photo-arc img {
        position: absolute;
        width: 112px;
        height: 140px;
        object-fit: cover;
        object-position: center top;
        border-radius: 8px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
        filter: saturate(0.95);
    }

    /* Center photo (lowest point) */
    .photo-arc img:nth-child(8) {
        left: -56px;
        top: 0px;
    }

    /* Left side singles - moving outward, rising gently */
    .photo-arc img:nth-child(7) { left: -180px; top: -20px; }
    .photo-arc img:nth-child(6) { left: -300px; top: -45px; }
    .photo-arc img:nth-child(5) { left: -420px; top: -75px; }

    /* Right side singles - perfect mirror */
    .photo-arc img:nth-child(9)  { left:  68px; top: -20px; }
    .photo-arc img:nth-child(10) { left: 188px; top: -45px; }
    .photo-arc img:nth-child(11) { left: 308px; top: -75px; }

    /* 2nd layer left stack */
    .photo-arc img:nth-child(3) {
        left: -540px;
        top: -200px;
    }
    .photo-arc img:nth-child(4) {
        left: -540px;
        top: -50px;
    }

    /* 2nd layer right stack (mirror: 540 - 112 = 428) */
    .photo-arc img:nth-child(12) {
        left: 428px;
        top: -200px;
    }
    .photo-arc img:nth-child(13) {
        left: 428px;
        top: -50px;
    }

    /* Far left stack */
    .photo-arc img:nth-child(1) {
        left: -660px;
        top: -280px;
    }
    .photo-arc img:nth-child(2) {
        left: -660px;
        top: -130px;
    }

    /* Far right stack (mirror: 660 - 112 = 548) */
    .photo-arc img:nth-child(14) {
        left: 548px;
        top: -280px;
    }
    .photo-arc img:nth-child(15) {
        left: 548px;
        top: -130px;
    }

    /* ===== TABLET ===== */
    @media (max-width: 1024px) {
        .apply-section {
            min-height: 640px;
            padding: 80px 24px 240px;
        }

        .photo-arc {
            top: 380px;
        }

        .photo-arc img {
            width: 96px;
            height: 120px;
        }
    }

    /* ===== MOBILE - Fade and crop ===== */
    @media (max-width: 768px) {
        .apply-section {
            padding: 80px 24px 200px;
            min-height: 560px;
        }

        .photo-arc {
            opacity: 0.35;
            top: 360px;
        }

        .photo-arc img {
            width: 80px;
            height: 100px;
        }

        .apply-content h2 {
            font-size: var(--text-2xl, 2rem);
        }

        .apply-details {
            flex-wrap: wrap;
            gap: 24px;
            padding: 20px;
        }

        .apply-detail {
            flex: 1 1 40%;
            min-width: 100px;
        }
    }

    /* ===== SMALL MOBILE ===== */
    @media (max-width: 480px) {
        .apply-section {
            padding: 60px 20px 180px;
            min-height: 520px;
        }

        .photo-arc {
            top: 340px;
        }

        .photo-arc img {
            width: 72px;
            height: 90px;
        }

        .apply-content h2 {
            font-size: var(--text-xl, 1.5rem);
        }

        .apply-details {
            gap: 20px;
            padding: 16px;
        }

        .apply-buttons {
            flex-direction: column;
            align-items: center;
            margin-top: -24px;
        }

        .apply-buttons :global(.btn) {
            width: auto;
            min-width: 200px;
        }
    }
</style>
